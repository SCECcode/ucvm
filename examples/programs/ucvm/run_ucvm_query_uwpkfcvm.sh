#!/bin/bash

if [ -z "$UCVM_INSTALL_PATH" ]; then
  echo "Need to set UCVM_INSTALL_PATH to run >" ${0##*/} 
  exit
fi
source $UCVM_INSTALL_PATH/conf/ucvm_env.sh

BIN_DIR=${UCVM_INSTALL_PATH}/bin
CONF_DIR=${UCVM_INSTALL_PATH}/conf
TEST_DIR=${UCVM_INSTALL_PATH}/tests/inputs
MODEL=uwpkfcvm

expect=$(mktemp) || exit 1
result=$(mktemp) || (trap 'rm -f "$expect"'; exit 1)

${BIN_DIR}/ucvm_query -m ${MODEL} -f ${CONF_DIR}/ucvm.conf < ${TEST_DIR}/test_latlons.txt  > $result 2>&1
${BIN_DIR}/ucvm_query -m ${MODEL} -f ${CONF_DIR}/ucvm.conf < ${TEST_DIR}/test_latlons_uwpkfcvm_gd.txt  >> $result 2>&1

cat > $expect << EOF_EXPECTED_RESULT
Using Geo Depth coordinates as default mode.
 -118.0000    34.0000      0.000    284.191    580.043       none      0.000      0.000      0.000       none      0.000      0.000      0.000       none      0.000      0.000      0.000
 -118.0000    34.0000     50.000    284.191    580.043       none      0.000      0.000      0.000       none      0.000      0.000      0.000       none      0.000      0.000      0.000
 -118.0000    34.0000    100.000    284.191    580.043       none      0.000      0.000      0.000       none      0.000      0.000      0.000       none      0.000      0.000      0.000
 -118.0000    34.0000    500.000    284.191    580.043       none      0.000      0.000      0.000       none      0.000      0.000      0.000       none      0.000      0.000      0.000
 -118.0000    34.0000   1000.000    284.191    580.043       none      0.000      0.000      0.000       none      0.000      0.000      0.000       none      0.000      0.000      0.000
Using Geo Depth coordinates as default mode.
 -120.6295    35.8431      0.000    391.599    446.958   uwpkfcvm   2020.000   1140.000   1914.304       none      0.000      0.000      0.000      crust   2020.000   1140.000   1914.304
 -120.6295    35.8431    500.000    391.599    446.958   uwpkfcvm   2020.000   1140.000   1914.304       none      0.000      0.000      0.000      crust   2020.000   1140.000   1914.304
 -120.6295    35.8431   1000.000    391.599    446.958   uwpkfcvm   4520.000   2350.000   2464.969       none      0.000      0.000      0.000      crust   4520.000   2350.000   2464.969
 -120.6295    35.8431   3000.000    391.599    446.958   uwpkfcvm   5110.000   3140.000   2551.959       none      0.000      0.000      0.000      crust   5110.000   3140.000   2551.959
 -120.0239    35.9312      0.000    192.672    351.900   uwpkfcvm   2550.000   1250.000   2108.454       none      0.000      0.000      0.000      crust   2550.000   1250.000   2108.454
 -120.0239    35.9312    500.000    192.672    351.900   uwpkfcvm   2550.000   1250.000   2108.454       none      0.000      0.000      0.000      crust   2550.000   1250.000   2108.454
 -120.0239    35.9312   1000.000    192.672    351.900   uwpkfcvm   3430.000   1880.000   2306.583       none      0.000      0.000      0.000      crust   3430.000   1880.000   2306.583
 -120.0239    35.9312   3000.000    192.672    351.900   uwpkfcvm   4410.000   2570.000   2449.774       none      0.000      0.000      0.000      crust   4410.000   2570.000   2449.774
 -120.5741    35.1491      0.000     86.068    385.100   uwpkfcvm   2600.000   1370.000   2123.168       none      0.000      0.000      0.000      crust   2600.000   1370.000   2123.168
 -120.5741    35.1491   4000.000     86.068    385.100   uwpkfcvm   4940.000   2850.000   2525.590       none      0.000      0.000      0.000      crust   4940.000   2850.000   2525.590
 -120.5702    35.1581      0.000    154.743    385.100   uwpkfcvm   2640.000   1380.000   2134.562       none      0.000      0.000      0.000      crust   2640.000   1380.000   2134.562
 -120.5702    35.1581   4000.000    154.743    385.100   uwpkfcvm   4860.000   2810.000   2513.605       none      0.000      0.000      0.000      crust   4860.000   2810.000   2513.605
 -120.5702    35.1581  10000.000    154.743    385.100   uwpkfcvm   6130.000   3970.000   2745.149       none      0.000      0.000      0.000      crust   6130.000   3970.000   2745.149
 -120.5778    35.1336      0.000     68.501    385.100   uwpkfcvm   2600.000   1370.000   2123.168       none      0.000      0.000      0.000      crust   2600.000   1370.000   2123.168
 -119.9342    35.5739      0.000    278.321    293.500   uwpkfcvm   2760.000   1450.000   2166.849       none      0.000      0.000      0.000      crust   2760.000   1450.000   2166.849
 -120.5050    35.9600      0.000    788.719    408.488   uwpkfcvm   2920.000   1380.000   2205.879       none      0.000      0.000      0.000      crust   2920.000   1380.000   2205.879
 -120.3026    36.6621      0.000     49.441    228.200   uwpkfcvm   2340.000   1230.000   2040.436       none      0.000      0.000      0.000      crust   2340.000   1230.000   2040.436
 -120.3026    36.6621  28000.000     49.441    228.200   uwpkfcvm   7350.000   4190.000   3073.382       none      0.000      0.000      0.000      crust   7350.000   4190.000   3073.382
EOF_EXPECTED_RESULT

echo "Running examples_programs_ucvm ucvm_query_uwpkfcvm"
if diff $result $expect > /dev/null 2>&1
then
  echo [SUCCESS]
else
  echo [FAILURE]
fi

trap 'rm -f "$expect" "$result"' exit

